"use strict";window.distributionMode=!0;try{window.nw=require("nw.gui"),window.win=nw.Window.get(),window.win.setPosition("center"),window.loadFile=function(e){require("fs").readFile(e,"utf8",function(e,t){if(e)return console.log(e);new global.window.APP.ProjectWorkspace(t).render()})},window.chooseFile=function(e,t){var i=global.$(e);i.unbind("change"),i.change(function(e){t(global.$(this).val())}),i.trigger("click")},global.$=$,global.window=window}catch(e){window.distributionMode=!1}window.changeUrl=function(e){var t=Backbone.history.getFragment(e);Backbone.history.fragment==t&&(Backbone.history.fragment=null),Backbone.history.navigate(t,!0)},window.MomentFormat="MM/Do/YYYY HH:mm:ss",window.ContextMenu=function(e,t,i){e.children("li").slice(i).remove();for(var n=0;n<t.length;n++)"link"==t[n].type?e.append($("<li/>").append($("<a/>",{href:t[n].url}).html(t[n].text))):"button"==t[n].type?e.append($("<li/>").append($("<a/>",{href:"javascript:void(0)",class:t[n].event}).html(t[n].text))):"submenu"==t[n].type?e.append($("<li/>",{class:"dropdown-submenu"}).append($("<a/>",{href:"javascript:void(0)",tabindex:"-1"}).html(t[n].text)).append(window.fillContextMenu($("<ul/>",{class:"dropdown-menu"}),t[n].child))):"separator"==t[n].type&&e.append($("<li/>",{class:"divider",role:"separator"}))},window.fillContextMenu=function(e,t){if(e.length&&t.length)for(var i=0;i<t.length;i++)"link"==t[i].type?e.append($("<li/>").append($("<a/>",{href:t[i].url}).html(t[i].text))):"button"==t[i].type?e.append($("<li/>").append($("<a/>",{href:"javascript:void(0)",class:t[i].event}).html(t[i].text))):"submenu"==t[i].type&&e.append($("<li/>",{class:"dropdown-submenu"}).append($("<a/>",{href:"javascript:void(0)",tabindex:"-1"}).html(t[i].text).append(window.fillMainMenu($("<ul/>",{class:"dropdown-menu"}),t[i].children))));return e},window.initializeMainMenu=function(e){$("#main-navigation").children("li:lt(-2)").remove();for(var t=e.length-1;t>=0;t--)"link"==e[t].type?$("#main-navigation").prepend($("<li/>").append($("<a/>",{href:e[t].url}).html(e[t].text))):"button"==e[t].type?$("#main-navigation").prepend($("<li/>").append($("<a/>",{href:"javascript:void(0)",class:e[t].event}).html(e[t].text))):"submenu"==e[t].type&&$("#main-navigation").prepend($("<li/>",{class:"dropdown-submenu"}).append($("<a/>",{href:"javascript:void(0)",tabindex:"-1"}).html(e[t].text)).append(window.fillMainMenu($("<ul/>",{class:"dropdown-menu"}),e[t].child)))},window.fillMainMenu=function(e,t){if(e.length&&t.length)for(var i=t.length-1;i>=0;i--)"link"==t[i].type?e.prepend($("<li/>").append($("<a/>",{href:t[i].url}).html(t[i].text))):"button"==t[i].type?e.prepend($("<li/>").append($("<a/>",{href:"javascript:void(0)",class:t[i].event}).html(t[i].text))):"submenu"==t[i].type&&e.prepend($("<li/>",{class:"dropdown-submenu"}).append($("<a/>",{href:"javascript:void(0)",tabindex:"-1"}).html(t[i].text).append(window.fillMainMenu($("<ul/>",{class:"dropdown-menu"}),t[i].children))));return e},String.prototype.format=function(){for(var e=this,t=0;t<arguments.length;t++){var i=new RegExp("\\{"+t+"\\}","gi");e=e.replace(i,arguments[t])}return e},window.rating=new RatingCore,window.rating.getStarsElmUpdate($(".programmerRating")),window.APP=window.APP||{},_.templateSettings={evaluate:/\{\{(.+?)\}\}/g,interpolate:/\{\{=(.+?)\}\}/g,escape:/\{\{-(.+?)\}\}/g},APP.ProjectModel=Backbone.Model.extend({defaults:{cid:"",name:"Tanpa Judul Program",dateCreated:"",dateModified:moment().format("MM/Do/YYYY HH:mm:ss"),code:{}},getDateCreated:function(){return moment(this.get("dateCreated"),"MM/Do/YYYY HH:mm:ss").fromNow()},getDateModified:function(){return moment(this.get("dateModified"),"MM/Do/YYYY HH:mm:ss").fromNow()},validate:function(e){var t={};if(e.name||(t.cid="Kesalahan pada project, silahkan tutup dan buka kembali project"),e.name||(t.name="Nama project tidak boleh kosong"),!_.isEmpty(t))return t}}),APP.ProjectCollection=Backbone.Collection.extend({model:APP.ProjectModel,localStorage:new Backbone.LocalStorage("fkd"),selectByCid:function(e){return this.filter(function(t){return t.get("cid")===e})[0]}}),APP.IntroView=Backbone.View.extend({el:$("#page"),template:$("#template--intro"),sec:$("#navbar"),section:$("#section--navbar"),mainMenu:[{type:"link",text:'<i class="icon-fa-new context-new"/>Program Baru',url:"#/new"},{type:"link",text:'<i class="icon-fa-new context-new"/>Daftar Program',url:"#/projects"}],initialize:function(){window.initializeMainMenu(this.mainMenu)},render:function(e){var t=_.template(this.template.html());$("body").addClass("intro"),$(".windowControl.page-help").addClass("disabled"),$(".windowControl.page-help").addClass("no-intro"),this.$el.html(t),this.sec.html(""),this.afterRender()},afterRender:function(e){PageDefault.init(),PageIntro.init()},close:function(){$("body").removeClass("intro")}}),APP.ProjectsView=Backbone.View.extend({el:$("#page"),template:$("#template--projectlist"),sec:$("#navbar"),section:$("#section--navbar"),mainMenu:[{type:"link",text:'<i class="icon-fa-new context-new"/>Program Baru',url:"#/new"},{type:"link",text:'<i class="icon-fa-new context-new"/>Kembali',url:"#/home"}],initialize:function(){window.initializeMainMenu(this.mainMenu),this.collection=new APP.ProjectCollection},handleEvents:function(){var e=this;$(".action-import").on("click",function(){e.importProject()})},deleteProject:function(e){var t=this;this.collection.fetch(),this.project=this.collection.selectByCid(e.cid),this.project.destroy({success:function(){t.render({message:"Berhasil Dihapus",type:"notif"})},error:function(){t.render({message:"Gagal Dihapus",type:"error"})}})},importProject:function(){var e=this;if(window.distributionMode){var t=$("<input/>",{style:"display:none;",id:"openFileDialog",type:"file"});$("body").append(t),editor.chooseFile("#openFileDialog",function(e){t.remove(),editor.loadFile(e)})}else e.render({message:"Gagal Membuka File",type:"error"})},exportProject:function(e){var t=this;if(this.collection.fetch(),this.project=this.collection.selectByCid(e.cid),window.distributionMode){var i=$("<input/>",{style:"display:none;",id:"saveFileDialog",type:"file",nwsaveas:"codename.freshkode"});$("body").append(i),editor.chooseFile("#saveFileDialog",function(e){i.remove();var n=require("fs"),a=t.project.get("code");n.writeFile(e,a,function(e){e?t.render({message:"Gagal Disimpan",type:"error"}):t.render({message:"Berhasil Disimpan",type:"notif"})})})}else t.render({message:"Gagal Disimpan",type:"error"})},render:function(e){this.leftSection='<span><a class="btn" href="#/home"><i class="fa fa-arrow-left"></i> Kembali</a></span>',this.centerSection="Daftar Program",this.rightSection='<span><button class="btn no-bg action-import"><i class="fa fa-download"></i> Impor file</button> <a class="btn" href="#/new">Program baru <i class="fa fa-asterisk"></i></a></span>';var t=_.template(this.section.html(),{variable:"data"})({leftSection:this.leftSection,centerSection:this.centerSection,rightSection:this.rightSection});this.sec.html(t),$("figcaption#pageName",this.$sec).toggleClass("active"),$(".windowControl.page-help").addClass("disabled"),$(".windowControl.page-help").addClass("no-intro");var i=this;this.collection.fetch({success:function(t){null!=e&&null!=e.message&&null!=e.type&&($("figure.text-effect #pageName").removeClass("active"),$("figure.text-effect #response").text(e.message).addClass("active"),$(".header-nav").addClass(e.type).delay(2e3).queue(function(t){$("figure.text-effect #pageName").addClass("active"),$("figure.text-effect #response").removeClass("active").text(""),$(this).removeClass(e.type),t()}));var n=_.template(i.template.html(),{variable:"data"})({projects:t.models});i.$el.html(n)}}),this.afterRender()},afterRender:function(e){this.handleEvents(),PageDefault.init(),PageProgram.init()},close:function(){}}),APP.ProjectWorkspace=Backbone.View.extend({el:$("#page"),template:$("#template--workspace"),sec:$("#navbar"),section:$("#section--navbar"),importFile:null,mainMenu:[{type:"button",text:'<i class="icon-fa-new context-new"/>Ekspor Menjadi Gambar',event:"action-exportToImg"},{type:"button",text:'<i class="icon-fa-new context-new"/>Simpan',event:"action-save"},{type:"button",text:'<i class="icon-fa-new context-new"/>Jalankan Program',event:"action-run"},{type:"link",text:'<i class="icon-fa-new context-new"/>Kembali',url:"#/home"}],initCode:{},exec:void 0,isRunning:!1,attrSelector:{name:""},initialize:function(e){this.importFile=e,window.initializeMainMenu(this.mainMenu),this.collection=new APP.ProjectCollection},initImportedProject:function(){this.project=new APP.ProjectModel,this.project.set("code",this.importFile)},initNewProject:function(){this.project=new APP.ProjectModel,this.project.set("code",JSON.stringify(Workspace.buildRawCode(),null,""))},initExitingProject:function(e){this.collection.fetch(),this.project=this.collection.selectByCid(e.cid)},handleEvents:function(){var e=this;$(".action-viewSelectedDiagram li > ul > li a:eq(0)").on("click",function(e){scrollToSelectedDiagram(),e.preventDefault()}),$(".action-viewSelectedDiagram li > ul > li > a:eq(1)").on("click",function(e){deleteSelectedDiagram(),e.preventDefault()}),$(".action-save").on("click",function(){e.saveProject()}),$(".action-run").on("click",function(){e.runProject()}),$(".action-exportToImg").on("click",function(){e.exportProjectToImage()}),$(".action-viewMessage").on("click",function(){window.dd2.changeTab("PESANCOM",function(){window.dd2.spesificIndex("PESANCOM").tab("show")})})},checkHasPO:function(){for(var e=Workspace.buildRawCode().rawCode.main,t=!1,i=!1,n=0;n<e.length;n++)switch(e[n].token){case"PRINT":case"PRINTLINE":i=!0;break;default:t=!0}return t&&i},checkHasIPO:function(){for(var e=Workspace.buildRawCode().rawCode.main,t=!1,i=!1,n=!1,a=0;a<e.length;a++)switch(e[a].token){case"INPUT":t=!0;break;case"PRINT":case"PRINTLINE":n=!0;break;default:i=!0}return t&&i&&n},firstRunning:!0,runProject:function(){if(this.firstRunning?this.firstRunning=!1:window.rating.restoreScore(),this.isRunning)this.isRunning=!1,this.exec.stop(!0);else{this.isRunning=!0;var e=this;$("figure.text-effect #pageName").removeClass("active"),$("figure.text-effect #response").text("program sedang dieksekusi...").addClass("active"),window.dd2.changeTab("OUTPUT",function(){window.dd2.spesificIndex("OUTPUT").tab("show")}),$(".header-nav").addClass("running"),$(".action-run",this.sec).html('<i class="fa fa-stop"></i> Berhenti'),this.exec=new Workspace.execute(function(){$("figure.text-effect #pageName").addClass("active"),$("figure.text-effect #response").removeClass("active").text(""),$(".header-nav").removeClass("running"),$(".action-run",e.sec).html('<i class="fa fa-play"></i> Jalankan'),e.isRunning=!1}),this.exec.start()}this.checkHasIPO()&&0==parseInt($("#compilerMessage").html())?window.rating.addScore(10):this.checkHasPO()&&0==parseInt($("#compilerMessage").html())?window.rating.addScore(5):window.rating.addScore(0)},firstSave:!0,saveProject:function(){this.firstSave?this.firstSave=!1:window.rating.restoreScore(),$("figure.text-effect #pageName").removeClass("active"),this.project.get("cid")||(this.project.set("cid",this.project.cid),this.project.set("dateCreated",moment().format("MM/Do/YYYY HH:mm:ss"))),this.project.set("name",this.attrSelector.name.val()),this.project.set("code",JSON.stringify(Workspace.buildRawCode(),null," ")),this.project.set("dateModified",moment().format("MM/Do/YYYY HH:mm:ss")),this.collection.add(this.project),this.project.save([],{success:function(){$("figure.text-effect #response").text("berhasil disimpan!").addClass("active"),$(".header-nav").addClass("notif").delay(2e3).queue(function(e){$("figure.text-effect #pageName").addClass("active"),$("figure.text-effect #response").removeClass("active").text(""),$(this).removeClass("notif"),e()})},error:function(){$(".header-nav").addClass("error").delay(2e3).queue(function(e){$("figcaption#pageName").addClass("active"),$(this).removeClass("error"),e()})}}),this.checkHasIPO()&&0==parseInt($("#compilerMessage").html())?window.rating.addScore(12):this.checkHasPO()&&0==parseInt($("#compilerMessage").html())?window.rating.addScore(7):window.rating.addScore(0)},exportProjectToImage:function(){$("figure.text-effect #pageName").removeClass("active"),$("figure.text-effect #response").text("sedang me-render gambar...").addClass("active");var e=$("#workspace").clone().addClass("__data_sc");$("body").append(e);var t=$("<input/>",{style:"display:none;",id:"saveFileDialogImg",type:"file",nwsaveas:"codename.png"});$("body").append(t),html2canvas(e,{onrendered:function(i){e.remove(),e=null;var n=i.toDataURL();n=n.replace(/^data:image\/(png|jpg|jpeg);base64,/,""),editor.chooseFile("#saveFileDialogImg",function(e){var i=require("fs");t.remove(),i.writeFile(e,n,"base64",function(){$("figure.text-effect #pageName").addClass("active"),$("figure.text-effect #response").removeClass("active").text("")})})}})},render:function(e){var t=[{type:"separator"},{type:"submenu",text:'<label class="label label-default" title="statement">s</label>&nbsp;&nbsp; IF',child:[{type:"button",text:'<i class="fa fa-sort"></i> Scroll pada posisi diagram',event:""},{type:"separator"},{type:"button",text:'<i class="fa fa-times"></i> Hapus Diagram',event:""}]}],i=$("<ul/>",{class:"dropdown-menu ddiagram",id:"main-navigation"}).append($("<li/>",{style:"color: #000;font-weight: 700;padding: 5px 10px 5px;"}).text("Diagram yang dipilih : "));window.ContextMenu(i,t,1),this.leftSection='<span><a class="btn" href="#/projects" title="kembali"><i class="fa fa-arrow-left"></i></a></span> <span class="action-viewSelectedDiagram" style="position:relative;float:right;text-transform:initial"><a class="btn no-bg dropdown-toggle disabled" href="#" title="diagram yang dipilih" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="color:#FFD348;"><i class="fa fa-hand-pointer-o"/></a>'+i.get(0).outerHTML+"</span>",this.centerSection="loading",this.rightSection='<button class="btn no-bg action-viewMessage" style="color: #FFD348"><i class="fa fa-exclamation-triangle"></i> <span id="compilerMessage">0</span></button><button class="btn no-bg action-save"><i class="fa fa-floppy-o"></i> Simpan</button> <span><button class="btn action-run"><i class="fa fa-play"></i> Jalankan</button></span>';var n=_.template(this.section.html(),{variable:"data"})({leftSection:this.leftSection,centerSection:this.centerSection,rightSection:this.rightSection});this.sec.html(n),this.attrSelector.name=$('<input type="text" class="form-control view-programName" placeholder="Nama program"/>'),$(".windowControl.page-help").removeClass("disabled"),$(".windowControl.page-help").removeClass("no-intro");var a=this;if(e&&e.cid){a.initExitingProject({cid:e.cid}),this.attrSelector.name.val(a.project.get("name")),$("figcaption#pageName",this.$sec).html(this.attrSelector.name);var o=_.template(a.template.html(),{variable:"data"})({project:a.project});a.$el.html(o)}else{null!=this.importFile?a.initImportedProject():a.initNewProject(),this.attrSelector.name.val("Program baru"),$("figcaption#pageName",this.$sec).html(this.attrSelector.name);var o=_.template(a.template.html(),{project:null});a.$el.html(o)}this.afterRender()},afterRender:function(e){this.handleEvents(),PageDefault.init(),this.tour=new TourCore,this.tour.init(!0),$(".action-undo").on("click",undoCommand_),$(".action-redo").on("click",redoCommand_),Gui.init(this.project.get("code")),window.dd1=new PageDefault.DropDown($(".nav-options#tbox-menu-ddown")),window.dd2=new PageDefault.DropDown($(".nav-options#output-menu-ddown")),$("figcaption#pageName",this.$sec).toggleClass("active"),$(".cd-side-navigation").children("ul").menuAim({activate:function(e){$(e).addClass("hover"),$(".cd-tour-wrapper").hasClass("active")&&"90px"==$(".cd-tour-wrapper.active > .cd-single-step.is-selected").css("left")&&$(".cd-tour-wrapper.active > .cd-single-step.is-selected").children(".cd-more-info").attr("style","transform:translate3d(300px,-50%,0);transition:.2s;")},deactivate:function(e){$(e).removeClass("hover"),$(".cd-tour-wrapper").hasClass("active")&&"90px"==$(".cd-tour-wrapper.active > .cd-single-step.is-selected").css("left")&&$(".cd-tour-wrapper.active > .cd-single-step.is-selected").children(".cd-more-info").attr("style","transform:translate3d(0,-50%,0);transition:.2s;")},exitMenu:function(){return $(".cd-side-navigation").find(".hover").removeClass("hover"),!0}}),$("#ddopr-type").change(function(){"0"==$(this).val()?$('.nav-opr-type a[href="#tabint"]').tab("show"):$('.nav-opr-type a[href="#tabreal"]').tab("show")})},close:function(){this.tour.destroy(),window.dd1.destroy(),window.dd2.destroy(),Gui.destroy()}}),APP.Router=Backbone.Router.extend({routes:{projects:"projects","project/:id":"getProject","delete/:id":"deleteProject","export/:id":"exportProject",new:"newProject","*other":"intro"},renderView:function(e,t){this.currentView&&this.currentView.close(),this.currentView=e,t?this.currentView.render(t):this.currentView.render()},intro:function(){this.renderView(new APP.IntroView)},projects:function(){this.renderView(new APP.ProjectsView)},newProject:function(){this.renderView(new APP.ProjectWorkspace)},getProject:function(e){this.renderView(new APP.ProjectWorkspace,{cid:e})},deleteProject:function(e){(new APP.ProjectsView).deleteProject({cid:e})},exportProject:function(e){(new APP.ProjectsView).exportProject({cid:e})},filter:function(e){var t=new APP.ProjectsView;t.filterType=e,t.trigger("change:filterType")}});var router=new APP.Router;Backbone.history.start();